<Window x:Class="OverlayTimer.DpsOverlayWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStyle="None"
        ResizeMode="CanResize"
        SizeToContent="WidthAndHeight"
        MinWidth="320"
        MinHeight="220"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        WindowStartupLocation="Manual"
        Left="760"
        Top="60"
        ShowInTaskbar="True"
        Loaded="Window_Loaded">

    <Grid x:Name="Root" IsHitTestVisible="False" Background="Transparent">
        <Border Background="#7A101820"
                CornerRadius="16"
                Padding="14">
            <StackPanel>
                <!-- 헤더: TOTAL DPS 레이블 + 초기화 (데이터 리셋 액션, 토글과 맥락 구분) -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="TOTAL DPS"
                               Foreground="#FFECEFF1"
                               FontSize="13"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"/>
                    <Button x:Name="ResetButton"
                            Grid.Column="1"
                            Width="54"
                            Height="20"
                            FontSize="11"
                            Content="&#xCD08;&#xAE30;&#xD654;"
                            Click="ResetButton_Click"
                            VerticalAlignment="Center"/>
                </Grid>

                <TextBlock x:Name="DpsText"
                           Text="0.0&#xB9CC;"
                           Foreground="White"
                           FontSize="38"
                           FontWeight="Bold"
                           Margin="0,2,0,4"/>

                <TextBlock x:Name="MetaText"
                           Text="Total 0.0&#xB9CC; / 0.0s"
                           Foreground="#FFDDE5EB"
                           FontSize="13"/>

                <!-- 버튼 행: 연동 패널 그룹 + 독립 패널 -->
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 대상별+스킬별: 선택 대상에 따라 스킬 통계가 연동되는 그룹 -->
                    <Border Grid.Column="0"
                            Background="#1AFFFFFF"
                            CornerRadius="6"
                            Padding="2">
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="TargetToggleButton"
                                    Width="108"
                                    Height="22"
                                    Content="&#xB300;&#xC0C1;&#xBCC4; &#xB370;&#xBBF8;&#xC9C0;"
                                    Click="TargetToggleButton_Click"/>
                            <Button x:Name="SkillToggleButton"
                                    Width="96"
                                    Height="22"
                                    Margin="4,0,0,0"
                                    Content="&#xC2A4;&#xD0AC;&#xBCC4; &#xD1B5;&#xACC4;"
                                    Click="SkillToggleButton_Click"/>
                        </StackPanel>
                    </Border>

                    <Button x:Name="BuffToggleButton"
                            Grid.Column="2"
                            Width="90"
                            Height="26"
                            Content="&#xBC84;&#xD504; &#xAC00;&#xB3D9;&#xB960;"
                            Click="BuffToggleButton_Click"/>
                </Grid>

                <Border x:Name="TargetPanel"
                        Visibility="Collapsed"
                        Margin="0,10,0,0"
                        Padding="8"
                        Background="#33141F27"
                        CornerRadius="10">
                    <StackPanel>
                        <TextBlock Text="&#xB300;&#xC0C1;&#xBCC4; &#xB370;&#xBBF8;&#xC9C0;"
                                   Foreground="#FFDDE5EB"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,6"/>

                        <ScrollViewer Height="180"
                                      VerticalScrollBarVisibility="Auto">
                            <ListBox x:Name="TargetItems"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     SelectionMode="Multiple"
                                     SelectionChanged="TargetItems_SelectionChanged">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border Background="{TemplateBinding Background}"
                                                            CornerRadius="4"
                                                            Padding="4,2">
                                                        <ContentPresenter/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter Property="Background" Value="#44FFFFFF"/>
                                            </Trigger>
                                            <MultiTrigger>
                                                <MultiTrigger.Conditions>
                                                    <Condition Property="IsMouseOver" Value="True"/>
                                                    <Condition Property="IsSelected" Value="False"/>
                                                </MultiTrigger.Conditions>
                                                <Setter Property="Background" Value="#22FFFFFF"/>
                                            </MultiTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Text="{Binding TargetLabel}"
                                                       Foreground="#FFB3C5D1"
                                                       FontSize="12"
                                                       VerticalAlignment="Center"/>

                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding DpsLabel}"
                                                       Foreground="White"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </ScrollViewer>
                    </StackPanel>
                </Border>

                <Border x:Name="SkillPanel"
                        Visibility="Collapsed"
                        Margin="0,10,0,0"
                        Padding="8"
                        Background="#33141F27"
                        CornerRadius="10">
                    <StackPanel>
                        <TextBlock x:Name="SkillPanelTitle"
                                   Text="&#xC2A4;&#xD0AC;&#xBCC4; &#xD1B5;&#xACC4;"
                                   Foreground="#FFDDE5EB"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,6"/>

                        <ScrollViewer Height="220"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="SkillItems">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,2"
                                                Padding="4,3"
                                                Background="#22FFFFFF"
                                                CornerRadius="4">
                                            <StackPanel>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="{Binding SkillLabel}"
                                                               Foreground="White"
                                                               FontSize="12"
                                                               FontWeight="SemiBold"/>
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding RatioLabel}"
                                                               Foreground="#FFFFCC44"
                                                               FontSize="12"
                                                               FontWeight="SemiBold"/>
                                                </Grid>
                                                <TextBlock Text="{Binding FlagLabel}"
                                                           Foreground="#FFB3C5D1"
                                                           FontSize="11"
                                                           Margin="0,1,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </StackPanel>
                </Border>
                <Border x:Name="BuffPanel"
                        Visibility="Collapsed"
                        Margin="0,10,0,0"
                        Padding="8"
                        Background="#33141F27"
                        CornerRadius="10">
                    <StackPanel>
                        <TextBlock x:Name="BuffPanelTitle"
                                   Text="&#xBC84;&#xD504; &#xAC00;&#xB3D9;&#xB960;"
                                   Foreground="#FFDDE5EB"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,6"/>

                        <ScrollViewer Height="180"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="BuffItems">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,2"
                                                Padding="4,3"
                                                Background="#22FFFFFF"
                                                CornerRadius="4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding BuffLabel}"
                                                           Foreground="White"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding UptimeLabel}"
                                                           Foreground="#FFFFCC44"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <TextBlock x:Name="BuffElapsedText"
                                   Foreground="#FF8899AA"
                                   FontSize="11"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </Grid>
</Window>
